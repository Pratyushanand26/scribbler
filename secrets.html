<!DOCTYPE html>
<html style="height:100%" lang="en">

<head>
	<!-- Meta data for SEO etc -->
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="icon" href="favicon.ico">

	<meta name="description"
		content="Scribbler is a notebook, online compiler for experimenting in JavaScript. Play with html and javascript using simple interface (without servers and backend deployment). All the computation happens in your browser.">
	<script>global = globalThis</script>
	<title>Secret Store for Scribbler</title>

	<!-- Styling using pico.css and some custome css -->
	<link rel="stylesheet" href="css/pico.min.css">
	<link rel="stylesheet" href="css/style.css">



	<script src="js/secrets.js"></script> <!-- Handling AI coding using WebLLM -->

	<style>
		#secretList {
			list-style: none;
			padding: 0;
			margin: 0;
		}

		#secretList li {
			list-style: none;
			border: 1px solid #ddd;
			border-radius: 10px;
			padding: 20px;
			margin-bottom: 20px;
			margin-left: 5px;
			margin-right: 5px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
		}

		#secretList li a {
			float: right;
			text-decoration: none;
			/* Remove underline */
			margin-left: 10px;
			/* Space between ✎ and × */
			cursor: pointer;
			/* Show pointer on hover */
		}

		#secretList li a:hover {
			transform: scale(1.2);
			border-radius: 50%;
			padding:0 4px 0 4px;
		}

		.secret-name {
			font-size: 1.4rem;
			margin: 0 1rem 0 1rem;

		}

		.api-input-wrapper {
			display: flex;
			align-items: center;
			gap: 10px;
			margin: 10px 0 10px 0;
		}

		.api-input-wrapper input {
			flex: 1;
			padding: 0.5rem;
			font-size: 1rem;
		}

		.api-input-wrapper button {
			padding: 0.5rem;
			font-size: 1rem;
			cursor: pointer;
			border: 1px solid #ccc;
			border-radius: 5px;
			background: #f5f5f5;
		}

		.api-input-wrapper button:hover {
			background: #e0e0e0;
		}
		
		.spacing{
			margin-top: 3px;
			margin-bottom: 3px;
		}
	</style>

</head>

<body style="height:100%">

	<nav id="menu"> <!-- Menu bar -->
		<ul style="width:50%;float:left;margin-top: 10px;">
			<li id="logo"><img src='images/logo2.png' id="" /></li>
			<h2 style="color:#555">Store Your Secrets</h2>

	</nav>

	<div class="container" id="ai-loading" style="margin-top:5px; padding:20px">
		<div class="row">
			<h3 style="color:green">None of the secrets will be shared with Scribbler or other servers unless explicity
				sent by a notebook. AI Api keys will only be sent to the respective service provider.</h3>
			<h3> Alert!! These secrets will be visible to any notebook that is taken out of sandbox. Be careful before
				breaking notebooks out of sandbox</h3>

			<hr>
			<h3 class="spacing">API Keys</h3>
			<h4 class="spacing">Google AI Studio</h4>
			<div class="api-input-wrapper">
				<input type="password" id="google-ai-studio-key"
					onchange="setAPIKey('google-ai-studio',document.getElementById('google-ai-studio-key').value)"
					placeholder="gemini-key"></input>
				<button type="button" class="toggle-eye"
					onclick="toggleVisibility('google-ai-studio-key',this)">🔒</button>
			</div>
			<a href='https://aistudio.google.com/app/apikey' target='_blank'>Link for getting Google AI Studio API
				Key</a>
			<p>This will be used for AI and will be sent to Google APIs</p>

			<h4 class="Spacing">OpenAI</h4>
			<div class="api-input-wrapper">
				<input type="password" id="openai-key"
					onchange="setAPIKey('openai',document.getElementById('openai-key').value)"
					placeholder="openai-key"></input>
				<button type="button" class="toggle-eye" onclick="toggleVisibility('openai-key',this)">🔒</button>
			</div>
			<a href='https://platform.openai.com/api-keys' target='_blank'>Link for getting OpenAI API Key</a>
			<p>This will be used for AI and will be sent to OpenAI APIs</p>

			<h4 class="Spacing">Groq</h4>
			<div class="api-input-wrapper">
				<input type="password" id="groq-key"
					onchange="setAPIKey('groq',document.getElementById('groq-key').value)"
					placeholder="groq-api-key"></input>
				<button type="button" class="toggle-eye" onclick="toggleVisibility('groq-key',this)">🔒</button>
			</div>
			<a href='https://console.groq.com/keys' target='_blank'>Link for getting Groq API Key</a>
			<p>This will be used for AI and will be sent to Groq APIs (ultra-fast inference)</p>
<form onsubmit="storeSecret(event)" class="secret-form">
	<h3 class="spacing">New Secret</h3>
	<p style="color:green">
		None of the secrets will be shared with Scribbler or other servers unless explicitly sent by a notebook.
	</p>

	<div class="form-row" style="display:flex; gap:20px; flex-wrap:wrap;">
		<div class="form-group" style="flex:1; min-width:200px;">
			<label for="name">Secret Name</label>
			<input type="text" id="name" name="name" placeholder="Enter name" required>
		</div>

		<div class="form-group" style="flex:1; min-width:200px;">
			<label for="value">Secret Value</label>
			<div style="display:flex; align-items:center; gap:10px;">
				<input type="password" id="value" name="value" placeholder="Enter value" required>
				<button type="button" onclick="toggleVisibility('value', this)">🔒</button>
			</div>
		</div>
	</div>

	<button type="submit" style="margin-top:10px;">Store Secret</button>
	<p style="margin-top:10px;">
		You can access the secret from notebooks using <code>scrib.getSecret(name)</code>
	</p>
</form>
		</div>
		<div>
			<ul id="secretList"></ul>
		</div>
	</div>




	<html-component data="components/footer.html"></html-component>


</body>

<script>
	storeSecret = function (e) {
		e.preventDefault();

		const name = document.getElementById("name").value;
		const value = document.getElementById("value").value;
		if (name && value) {
			setSecret(name, value);
			document.getElementById("name").value = '';
			document.getElementById("value").value = '';
		}
		else {

			alert("Cannot have empty values");
		}
		updateSecrets();

	}

	updateSecrets = function () {
		const secretNames = getSecretNames(); // assumes getSecretNames() exists
		const secretList = document.getElementById("secretList");
		secretList.innerHTML = '';

		secretNames.forEach(name => {
			const li = document.createElement("li");

			li.innerHTML = `
                <h2 >
                    ${name}
                    &nbsp;
                    <a href="#"  class="secret-name" onclick="deleteSecret('${name}');updateSecrets();return false;">×</a>
                    &nbsp;
                    <a href="#"  class="secret-name" onclick="editSecret('${name}');return false;">✎</a>
                </h2>
            `;

			secretList.appendChild(li);
		});
	}

	function editSecret(name) {
		const currentValue = getSecret(name); // assumes getSecret(name) exists
		const newValue = prompt(`Edit value for "${name}"`, currentValue);
		if (newValue !== null) { // user didn't cancel
			setSecret(name, newValue); // assumes setSecret(name, value) exists
			updateSecrets();
		}
	}

	updateSecrets();


	//This loads components dynamically
	class DynamicInclude extends HTMLElement {
		connectedCallback() {
			const url = this.getAttribute('data');
			fetch(url)
				.then(response => response.text())
				.then(content => {
					this.innerHTML = content;
				});
		}
	}
	
	function toggleVisibility(inputId, btn) {
		const input = document.getElementById(inputId);
		if (input.type === "password") {
			input.type = "text";
			btn.textContent = "🔓";    
		} else {
			input.type = "password";
			btn.textContent = "🔒";    
		}
	}

	customElements.define('html-component', DynamicInclude);


</script>

</html>